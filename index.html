<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <script src="products.js"></script>    
    <title>MATH</title>
</head>
<body>
<div class="main-wrapper">
    <div id="app">

    <nav class="nav">
        <div class="logo">
            <img class="logoH" height="100px" src="./image/gr.png">
        </div>
        <div class="Courses">
        <h1>Courses</h1>
        </div>
    
        <div class="checkOut">
            <button class="checkB" @click='showCheckOut'>
                {{cartItemCount}}
                <span id="cart" class="fas fa-cart-plus"></span> 
            </button>
        </div>
    </nav>

    <div class="page" v-if="showProduct">
        <div class="search">
            <input id="searchS" type="text" v-model="search" @keyup="searcher" >
            <BR>
            <!-- <select  id="order"> -->
           
            <input type="radio" id="Assend" name="order" value="Assending" checked="checked" @click=" sorter">Assending
                <input type="radio" id="Dessend"name="order" value="Dessending"@click=" sorter">Dessending
            <!-- </select> -->
            <!-- <select  id="orderType"> -->
                <input type="radio"  id="Price" name="oType" value="Price"checked="checked"@click=" sorter">Price
                <input type="radio" id="location" name="oType" value="location"@click=" sorter">location
                <input type="radio" id="Subject" name="oType" value="Subject"@click=" sorter">Subject
                <input type="radio" id="Space" name="oType" value="Space"@click=" sorter">Space

            <!-- </select> -->
            <!-- @:input="searcher"> -->
            <!-- <button class="searchB" @click="searcher"><span class="fa-solid fa-broom"></span></button> -->
        </div>
        <div class="productss" >
                <div class="product" v-for="product in products" v-if="product.show===true" style="border: solid black 2px; border-radius: 40px; height: 200px; width: 300px;"> 
                    <figure>
                    <img height="100px" v-bind:src="product.image">
                    </figure>
                    <div id="content">
                        <p >Subject: <b>{{product.title}}</b></p>
                        <p> City: {{product.location}}</p>
                        <p>Price: {{product.price}}</p>
                        <p>space: {{product.quantity}}</p>
                        <!-- <input type="button" value="add" @click='addItem' v-show='canAdd(product)'> -->
                        <div>
                            <span v-for="n in product.rating"><i class="fa-regular fa-star"></i></span>
                        <span v-for="n in 5-product.rating"><i class="fa-solid fa-star"></i></span>
     
                        </div>
                       
                        <button id="Mbutton" @click='addItem(product)' v-bind:disabled="!canAdd(product)">Add</button>
                        <!-- <button disabled="disabled"v-else="canAdd(product)">Add</button> -->
                        <span v-if="product.quantity === cartCount(product.id)">
                            All out!!
                        </span>
                        <span v-else-if="product.quantity  < 5">
                            only {{product.quantity }} left!
                        </span>
                        <span v-else>Buy now!!</span>
                    </div>
                </div>
        </div>
    </div>
    <div class="carPage" v-else>
        <div class="cartWrapper">
            <h2>CART</h2>
            <div class="cartItem"  v-for="items in removeDuplicates(cart)" v-if="cartCount(items)">
                     {{items}}   {{productFinder(items).title}} {{productFinder(items).price}} {{cartCount(items)}}
                     <button @click="removeCart(items,cartCount(items))">remove</button>
            </div>
            <h2>Checkout</h2>
            <p><strong>First Name:</strong>
                <!-- This input field is bound to 'firstName' in the 'order' object -->
                <input v-model.trim="order.firstName"/>
            </p>
            <p>
                <strong>Last Name:</strong>
                <!-- This input field is bound to 'lastName' in the 'order' object -->
                <input v-model.trim="order.lastName"/>
            </p>
            <p><strong>Phone Number:</strong> <input v-model="order.Phone"/></p>
            <button v-on:click="submitForm"v-bind:disabled="!cartItemCount" >Place Order</button>
        </div>
    </div>
    </div>
</div>
<script>
    let webstore = new Vue({
        el: '#app',
        data: {
            sitename: 'Available Courses',
            showProduct: true,
            search:'',
            order:{
                firstName: " ",
                lastName:' ',
                address:'',
                city:'',
                state: '',
                zip:'',
                gift:'',
                sendGift:'Send as a Gift',
                dontSendGift:'Do not send as a Gift',
                method:'home',
                rating: 3
            },
            states: {
                AL: 'Alabama',
                AR: 'Arizona',
                CA: 'California'
            },
            products:products,
            cart: []
        },
        methods: {
            addItem(product){
                if(product.quantity>0)
                {
                    product.quantity-=1 ;
                    this.cart.push( product.id);
                }
            },
            showCheckOut(){
                this.showProduct = this.showProduct ?false:true;
            },
            submitForm(){
                alert('Order submitted!');
            },
            canAdd(product){
                return product.
                quantity!=0
                    
            },
            cartCount(id){
                let count = 0
                for (let i = 0; i < this.cart.length;i++)
                {
                    if(this.cart[i] === id){
                        count++;
                    }
                }
                return count;
            },
            removeDuplicates(arr) {
                var unique = [];
                arr.forEach(element => {
                    if (!unique.includes(element)) {
                        unique.push(element);
                    }
                });
                return unique;
             },
             productFinder(id) {
               for (let i =0; i<products.length;i++)
               {
                if(products[i].id===id)
                    return products[i];
               }
             },
             removeCart(id,count){
              
                for(let i =0;i<this.cart.length;i++)
                    {
                        let tmp;
                        if(id===this.cart[i])
                        {
                            this.cart.splice(i,1);
                            this.productFinder(id).quantity+=1;
                            break;
                        }
                    }
             },
             searcher(){
                this.products.forEach((element) => {
                    if(!this.search && this.search ==="")
                        element.show= true;
                    let i=0;
                    while(this.search && i < this.search.length && i < (element.title.length || element.location.length))
                    {
                        if (this.search[i]===element.title[i]|| this.search[i]===element.location[i])
                            element.show= true;
                        else{
                            element.show = false;
                            break;
                        }
                        i++
                    }
                });
            },
            sorter()
            {
                if(document.getElementById('Price').checked===true)
                {
                    console.log(document.getElementById('Price').value)
                    function compare(a,b){
                        if (a.price > b.price)
                            return 1;
                        if (a.price < b.price)
                            return -1
                        return 0;
                    }
                     products.sort(compare);
                }
                else if(document.getElementById('location').checked===true)
                {
                    console.log(document.getElementById('location').value)
                    function compare(a,b){
                        if (a.location > b.location)
                            return 1;
                        if (a.location < b.location)
                            return -1
                        return 0;
                    }
                     products.sort(compare);
                }
                else if(document.getElementById('Subject').checked===true)
                {
                    console.log(document.getElementById('Subject').value)
                    function compare(a,b){
                        if (a.title > b.title)
                            return 1;
                        if (a.title < b.title)
                            return -1
                        return 0;
                    }
                     products.sort(compare);
                }
                else if(document.getElementById('Space').checked===true)
                {
                    console.log(document.getElementById('Space').value)
                    function compare(a,b){
                        if (a.quantity > b.quantity)
                            return 1;
                        if (a.quantity < b.quantity)
                            return -1
                        return 0;
                    }
                     products.sort(compare);
                }

                if(document.getElementById('Assend').checked===true)
                ;
                else if(document.getElementById('Dessend').checked===true)
                {
                    console.log(document.getElementById('Dessend').value)
                    products.reverse();
                }

            }
        },
        computed: {
            cartItemCount: function() {
                return this.cart.length || '';
            }
        }
    });
</script>
</body>
</html>